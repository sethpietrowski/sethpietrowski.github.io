import{r as S,j as d,B as $e}from"./index-CdavgHE5.js";function re(e,t,o,r){return(1-e)**2*t+2*(1-e)*e*o+e**2*r}function Y(e,t,o,r,l){e=Math.max(0,Math.min(e,o.exit_x));const c=e/o.exit_x,a=o,u=re(c,re(c,a.inlet_radius,a.cp1y,a.throat_radius),re(c,a.throat_radius,a.cp2y,a.switcher_y),re(c,a.switcher_y,a.cp3y,a.exit_radius))*r;return t?l/2-u:l/2+u}function qe(e,t,o,r,l){const c=Array(e).fill(0),a=Array(e).fill(0);for(let i=0;i<e;i++){const u=i*t+t/2,m=t;if(i<e-1){const p=Y(u,!0,o,r,l),g=Y(u,!1,o,r,l),v=Y(u+m,!0,o,r,l),y=Y(u+m,!1,o,r,l);c[i]=Math.atan2(v-p,m),a[i]=Math.atan2(y-g,m)}else c[i]=c[i-1]||0,a[i]=a[i-1]||0}return{top:c,bottom:a}}function Ge(e,t,o,r){if(e<=0)return t.inlet_radius*o;if(e>=t.exit_x)return t.exit_radius*o;const l=Y(e,!0,t,o,r),c=Y(e,!1,t,o,r);return Math.abs(c-l)/2}function Oe(e){const{rows:t,cols:o,cellWidth:r,cellHeight:l,controlPoints:c,scaleY:a,canvasHeight:i}=e;console.log("Creating flow domain with dimensions:",o,"x",t),e.isInside=Array.from({length:t},()=>Array(o).fill(!1)),e.isBoundary=Array.from({length:t},()=>Array(o).fill(!1));const u=qe(o,r,c,a,i);e.wallAngleTop=u.top,e.wallAngleBottom=u.bottom;for(let g=0;g<t;g++)for(let v=0;v<o;v++){const y=v*r+r/2,C=g*l+l/2;if(y<=c.exit_x){const f=Y(y,!0,c,a,i),h=Y(y,!1,c,a,i);if(C>=f&&C<=h){e.isInside[g][v]=!0;const M=Math.abs(C-f),A=Math.abs(C-h),I=Math.min(M,A),b=Math.max(r,l)*1.5;I<b&&(e.isBoundary[g][v]=!0)}}}let m=0,p=0;for(let g=0;g<t;g++)for(let v=0;v<o;v++)e.isInside[g][v]&&(e.isBoundary[g][v]?p++:m++);console.log(`Domain created: ${m} interior cells, ${p} boundary cells`)}function we(e){const{rows:t,cols:o,isInside:r,isBoundary:l}=e,c=3e5,a=100,i=300,u=3.5;console.log("Initializing flow field...");for(let m=0;m<t;m++)for(let p=0;p<o;p++)if(r[m][p]&&!l[m][p]){const g=p/(o-1);e.velocityX[m][p]=a*(1+g*.5),e.velocityY[m][p]=0,e.pressure[m][p]=c*(1-g*.3),e.density[m][p]=u*(1-g*.2),e.temperature[m][p]=i*(1-g*.1)}else l[m][p]&&(e.velocityX[m][p]=0,e.velocityY[m][p]=0);console.log("Flow field initialized.")}let ce=[],fe=[],me=[];function Qe(e,t){ce.length===0&&(ce=Array.from({length:e},()=>Array(t).fill(0)),fe=Array.from({length:e},()=>Array(t).fill(0)),me=Array.from({length:e},()=>Array(t).fill(0)))}function Ke(e){const{rows:t,cols:o,velocityX:r,velocityY:l,pressure:c}=e;Qe(t,o);for(let a=0;a<t;a++)for(let i=0;i<o;i++)ce[a][i]=r[a][i],fe[a][i]=l[a][i],me[a][i]=c[a][i]}function Je(e,t,o,r,l){const{velocityX:c,velocityY:a,cellWidth:i,cellHeight:u,rows:m,cols:p}=l;let g=0,v=0;if(o>.3){if(t>0&&t<p-1){const y=c[e][t+1]-c[e][t-1];g=-.1*r*Math.abs(y)*y/(2*i)}if(e>0&&e<m-1){const y=a[e+1][t]-a[e-1][t];v=-.1*r*Math.abs(y)*y/(2*i)}}return{x:g,y:v}}function Ce(e){const{rows:t,cols:o,isInside:r,isBoundary:l,velocityX:c,velocityY:a,pressure:i,density:u,cellWidth:m,cellHeight:p}=e;let g=0,v=0,y=0,C=0;for(let f=1;f<t-1;f++)for(let h=1;h<o-1;h++)if(r[f][h]&&!l[f][h]){const M=c[f][h]-ce[f][h],A=a[f][h]-fe[f][h];g+=M*M+A*A;const I=i[f][h]-me[f][h];v+=I*I;const b=u[f][h],w=u[f][h-1]||b,_=u[f][h+1]||b,D=u[f-1][h]||b,U=u[f+1][h]||b,N=c[f][h-1]||c[f][h],E=c[f][h+1]||c[f][h],W=a[f-1][h]||c[f][h],k=a[f+1][h]||c[f][h],R=(_*E-w*N)/(2*m),z=(U*k-D*W)/(2*p),B=Math.abs(R+z);y+=B*B,C++}return{velocity:Math.sqrt(g/Math.max(C,1)),pressure:Math.sqrt(v/Math.max(C,1)),mass:Math.sqrt(y/Math.max(C,1))}}function Ze(e){const t=P;t.velocity.push(e.velocity),t.pressure.push(e.pressure),t.mass.push(e.mass),t.velocity.length>t.maxHistory&&(t.velocity.shift(),t.pressure.shift(),t.mass.shift())}function et(e){const t=e.velocity<ee.velocity,o=e.pressure<ee.pressure,r=e.mass<ee.mass;return t&&o&&r}function tt(e){if(j.state!=="running"||!e)return!1;Ke(e);const t=1.4,o=287,r=3e5,l=100,c=300,a=3.5,i=.15,u=.05,{rows:m,cols:p,cellWidth:g,cellHeight:v,isInside:y,isBoundary:C,velocityX:f,velocityY:h,pressure:M,density:A,temperature:I,controlPoints:b,scaleY:w,canvasHeight:_,wallAngleTop:D,wallAngleBottom:U}=e;let N=0;for(let n=0;n<m;n++)for(let s=0;s<p;s++)if(y[n][s]){const K=Math.sqrt(f[n][s]**2+h[n][s]**2);N=Math.max(N,K)}const W=Math.min(1e-4,.5*Math.min(g,v)/Math.max(N,1)),k=f.map(n=>[...n]),R=h.map(n=>[...n]),z=M.map(n=>[...n]),B=A.map(n=>[...n]),O=I.map(n=>[...n]);for(let n=0;n<m;n++)for(let s=0;s<4;s++)y[n][s]&&!C[n][s]&&(k[n][s]=l,R[n][s]=0,z[n][s]=r,B[n][s]=a,O[n][s]=c);for(let n=2;n<m-2;n++)for(let s=3;s<p-3;s++){if(!y[n][s]||C[n][s])continue;const K=s*g+g/2,ne=n*v+v/2,G=A[n][s],X=f[n][s],H=h[n][s],se=M[n][s],oe=Math.sqrt(t*se/G),Q=Math.sqrt(X*X+H*H)/oe;let V,$,q,T,F,J;Q<.8?(V=(M[n][s+1]-M[n][s-1])/(2*g),$=(M[n+1][s]-M[n-1][s])/(2*v),q=(f[n][s+1]-f[n][s-1])/(2*g),T=(f[n+1][s]-f[n-1][s])/(2*v),F=(h[n][s+1]-h[n][s-1])/(2*g),J=(h[n+1][s]-h[n-1][s])/(2*v)):(X>0?(V=(M[n][s]-M[n][s-1])/g,q=(f[n][s]-f[n][s-1])/g,F=(h[n][s]-h[n][s-1])/g):(V=(M[n][s+1]-M[n][s])/g,q=(f[n][s+1]-f[n][s])/g,F=(h[n][s+1]-h[n][s])/g),H>0?($=(M[n][s]-M[n-1][s])/v,T=(f[n][s]-f[n-1][s])/v,J=(h[n][s]-h[n-1][s])/v):($=(M[n+1][s]-M[n][s])/v,T=(f[n+1][s]-f[n][s])/v,J=(h[n+1][s]-h[n][s])/v));const xe=Je(n,s,Q,G,e),ue=canvas.height/2,be=Ge(K,b,w,_),ze=b.throat_radius*w,_e=ne<ue?D?D[s]:0:U?U[s]:0;let ae=0;if(be>ze*1.1){const He=Math.abs(ne-ue)/be;ae=Math.sin(_e)*X*He*.05,ne>ue&&(ae=-ae)}const ke=X*F+H*T,Ne=X*q+H*J,Be=-V/Math.max(G,.5)-ke*.2+xe.x,Ve=-$/Math.max(G,.5)-Ne*.2+ae+xe.y,ie=.5*oe/W,Pe=Math.max(-ie,Math.min(ie,Be)),Le=Math.max(-ie,Math.min(ie,Ve));k[n][s]=X+Pe*W,R[n][s]=H+Le*W;const We=800,Me=200;k[n][s]=Math.max(.01,Math.min(We,k[n][s])),R[n][s]=Math.max(-Me,Math.min(Me,R[n][s]));const Ye=k[n][s]**2+R[n][s]**2,De=X**2+H**2,Ue=t/(t-1)*se/G+.5*De-.5*Ye;O[n][s]=Math.max(.1,Ue*(t-1)/t),z[n][s]=Math.max(.05,G*o*O[n][s]);const Xe=Math.min(5,Math.max(.01,z[n][s]/r));B[n][s]=Math.max(.5,a*Math.pow(Xe,1/t)),O[n][s]=Math.min(500,Math.max(200,O[n][s])),z[n][s]=Math.min(5e5,Math.max(5e4,z[n][s])),B[n][s]=Math.min(5,Math.max(.5,B[n][s]))}for(let n=0;n<m;n++)for(let s=0;s<p;s++){if(!C[n][s])continue;const K=n*v+v/2,ne=s*g+g/2;let G=l,X=0,H=r,se=a,oe=c,Q=!1;for(let V=2;V<=6&&!Q;V++)for(let $=-V;$<=V&&!Q;$++)for(let q=-V;q<=V&&!Q;q++){const T=n+$,F=s+q;T>=0&&T<m&&F>=0&&F<p&&y[T][F]&&!C[T][F]&&(G=f[T][F],X=h[T][F],H=M[T][F],se=A[T][F],oe=I[T][F],Q=!0)}if(Q){const V=Y(ne,!0,b,w,_);Y(ne,!1,b,w,_);const $=Math.abs(K-V),q=Math.min($,disTopBottomWall),T=Math.max(g,v)*1.5,F=Math.min(1,q/T),J=Math.pow(F,.3);k[n][s]=G*J,R[n][s]=X*J*.7,z[n][s]=H,B[n][s]=se,O[n][s]=oe}}for(let n=0;n<m;n++)for(let s=p-4;s<p;s++)if(y[n][s]&&!C[n][s]){const K=s>0?(f[n][s]-f[n][s-1])/g:0;k[n][s]=Math.max(f[n][s],f[n][s]+K*g),R[n][s]=h[n][s],z[n][s]=Math.max(5e4,M[n][s]*.98),B[n][s]=A[n][s]*.99,O[n][s]=I[n][s]}for(let n=0;n<m;n++)for(let s=0;s<p;s++)y[n][s]&&(f[n][s]=i*k[n][s]+(1-i)*f[n][s],h[n][s]=i*R[n][s]+(1-i)*h[n][s],M[n][s]=u*z[n][s]+(1-u)*M[n][s],A[n][s]=u*B[n][s]+(1-u)*A[n][s],I[n][s]=u*O[n][s]+(1-u)*I[n][s]);const ye=Ce(e);return Ze(ye),et(ye)?(updateSimulationStatus("converged"),!1):(j.totalIterations++,j.totalIterations>1e4?(console.log("Maximum iterations reached"),!1):!0)}function nt(e){return Ce(e)}function st(e,t,o){const r=e.getContext("2d");return e.width=1e3,e.height=500,r.clearRect(0,0,e.width,e.height),t&&(t.width=30,t.height=400),o&&(o.width=380,o.height=250),r}function Se(e,t){const{controlPoints:o,scaleY:r,canvasHeight:l}=t;if(!o)return;e.strokeStyle="#333",e.lineWidth=2,e.fillStyle="rgba(100,100,100,0.3)";const c=200;e.beginPath();for(let a=0;a<=c;a++){const i=a/c*o.exit_x,u=Y(i,!0,o,r,l);a===0?e.moveTo(i,u):e.lineTo(i,u)}for(let a=c;a>=0;a--){const i=a/c*o.exit_x,u=Y(i,!1,o,r,l);e.lineTo(i,u)}e.closePath(),e.fill(),e.stroke(),e.strokeStyle="rgba(0,0,0,0.4)",e.lineWidth=2,e.setLineDash([10,5]),e.beginPath(),e.moveTo(0,l/2),e.lineTo(o.exit_x,l/2),e.stroke(),e.setLineDash([])}function Ee(e,t,o=null){const{rows:r,cols:l,velocityX:c,velocityY:a,pressure:i,temperature:u,density:m,isInside:p,isBoundary:g,cellWidth:v,cellHeight:y,visualizationMode:C}=t;let f;switch(C){case"pressure":f=i;break;case"temperature":f=u;break;case"density":f=m;break;case"velocity":f=Array.from({length:r},(b,w)=>Array.from({length:l},(_,D)=>{if(!c[w])return 0;const U=c[w][D]||0,N=a[w][D]||0;return Math.sqrt(U*U+N*N)}));break;default:f=i}const h=[];for(let b=0;b<r;b++)for(let w=0;w<l;w++)if(p[b][w]&&!g[b][w]){const _=Array.isArray(f[b][w])?f[b][w]:0;!isNaN(_)&&isFinite(_)&&h.push(_)}if(h.length===0)return;const M=Math.min(...h),A=Math.max(...h),I=h.reduce((b,w)=>b+w,0)/h.length;o?.onStatsUpdate&&o.onStatsUpdate({min:M,max:A,avg:I}),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";for(let b=0;b<r;b++)for(let w=0;w<l;w++){if(!p[b][w])continue;const _=Array.isArray(f[b][w])?f[b][w]:0,D=je(_,M,A,C);e.fillStyle=D,e.fillRect(w*v,b*y,v,y)}ot(M,A,C)}function je(e,t,o,r){isFinite(e)||(e=t);let l=0;o>t&&(l=Math.max(0,Math.min(1,(e-t)/(o-t))));let c,a,i;switch(r){case"velocity":if(l<.25){const u=l/.25;c=0,a=Math.floor(u*255),i=255}else if(l<.5){const u=(l-.25)/.25;c=0,a=255,i=Math.floor(255*(1-u))}else if(l<.75){const u=(l-.5)/.25;c=Math.floor(u*255),a=255,i=0}else{const u=(l-.75)/.25;c=255,a=Math.floor(255*(1-u)),i=0}break;case"pressure":case"temperature":case"density":c=Math.floor(l*255),a=0,i=Math.floor((1-l)*255);break;default:c=Math.floor(l*255),a=Math.floor(l*128),i=Math.floor((1-l)*255)}return`rgb(${c}, ${a}, ${i})`}function ot(e,t,o){const r=document.getElementById("colorbar");if(!r)return;const l=r.getContext("2d"),c=r.height,a=r.width;l.clearRect(0,0,a,c);const i=l.createLinearGradient(0,c,0,0),u=20;for(let y=0;y<=u;y++){const C=y/u,f=e+C*(t-e),h=je(f,e,t,o);i.addColorStop(C,h)}l.fillStyle=i,l.fillRect(0,0,a,c),l.strokeStyle="#ccc",l.lineWidth=1,l.strokeRect(0,0,a,c);const m=document.getElementById("max-label"),p=document.getElementById("min-label"),g=document.getElementById("colorbar-title");m&&(m.textContent=t.toFixed(3)),p&&(p.textContent=e.toFixed(3));const v={velocity:"Velocity (m/s)",pressure:"Pressure (Pa)",temperature:"Temperature (K)",density:"Density (kg/mÂ³)"};g&&(g.textContent=v[o]||"Value")}function Ie(e){if(!e){console.warn("Convergence canvas not found");return}const t=e.getContext("2d");if(!t){console.warn("Could not get convergence canvas context");return}const o=e.width,r=e.height;t.clearRect(0,0,o,r),t.fillStyle="rgba(0,0,0,0.8)",t.fillRect(0,0,o,r),(!P||P.velocity.length<2)&&(t.fillStyle="rgba(255,255,255,0.8)",t.font="16px Arial",t.textAlign="center",t.fillText("No convergence data yet",o/2,r/2));const l=[...P.velocity.filter(p=>isFinite(p)&&p>0),...P.pressure.filter(p=>isFinite(p)&&p>0),...P.mass.filter(p=>isFinite(p)&&p>0)];if(l.length===0){t.fillstyle="rgba(255,255,255,0.8)",t.font="16px Arial",t.textAlign="center",t.fillText("Invalid convergence data",o/2,r/2);return}const c=Math.max(1e-12,Math.min(...l)),a=Math.max(c*10,Math.max(...l)),i=Math.log10(c),u=Math.log10(a),m=u-i;if(m<=0){t.fillstyle="rgba(255,255,255,0.8)",t.font="16px Arial",t.textAlign="center",t.fillText("Insufficient data range",o/2,r/2);return}at(t,o,r,i,u,m),it(t,o,r,i,m),drawConvergenceLabels(t,o,r,i,m),rt(t,o)}function at(e,t,o,r,l,c){e.strokeStyle="rgba(255,255,255,0.2)",e.lineWidth=1,e.font="10px Arial",e.fillStyle="rgba(255,255,255,0.7)";for(let i=Math.floor(r);i<=Math.ceil(l);i++){const u=o-(i-r)/c*o;e.beginPath(),e.moveTo(0,u),e.lineTo(t,u),e.stroke(),e.textAlign="left",e.fillText(`1e${i}`,5,u-2)}const a=P.velocity.length;if(a>1){const i=Math.max(1,Math.floor(a/5));for(let u=0;u<a;u+=i){const m=u/(a-1)*t;e.beginPath(),e.moveTo(m,0),e.lineTo(m,o),e.stroke(),u%(i*2)===0&&(e.textAlign="center",e.fillText(u.toString(),m,o-5))}}}function it(e,t,o,r,l){[{data:P.velocity,color:"blue",label:"Velocity"},{data:P.pressure,color:"green",label:"Pressure"},{data:P.mass,color:"red",label:"Mass"}].forEach(a=>{if(a.data.length<2)return;e.strokeStyle=a.color,e.lineWidth=2,e.beginPath();let i=!1;for(let u=0;u<a.data.length;u++){const m=a.data[u];if(!isFinite(m)||m<=0)continue;const p=a.data.length>1?u/(a.data.length-1)*t:t/2,g=Math.log10(Math.max(1e-12,m)),v=o-(g-r)/l*o;i?e.lineTo(p,v):(e.moveTo(p,v),i=!0)}i&&e.stroke()})}function rt(e,t,o){const r=[{color:"blue",label:"Velocity"},{color:"green",label:"Pressure"},{color:"red",label:"Mass"}];e.font="12px Arial",e.textAlign="left",r.forEach((l,c)=>{const a=t-80,i=20+c*20;e.fillStyle=l.color,e.fillRect(a,i-8,12,12),e.fillStyle="white",e.fillText(l.label,a+16,i+2)})}function te(e){j.state=e;const t=document.getElementById("simulation-status"),o=document.getElementById("status-indicator"),r=document.getElementById("start-btn"),l=document.getElementById("pause-btn");if(!t||!o||!r||!l){console.log("Status updated to: ",e,"(DOM elements not found)");return}const a={running:{text:"Running",class:"status-indicator status-running",startDisabled:!0,pauseDisabled:!1},paused:{text:"Paused",class:"status-indicator status-paused",startDisabled:!1,pauseDisabled:!0},converged:{text:"Converged",class:"status-indicator status-converged",startDisabled:!1,pauseDisabled:!0},stopped:{text:"Ready",class:"status-indicator status-paused",startDisabled:!1,pauseDisabled:!0},ready:{text:"Ready",class:"status-indicator status-paused",startDisabled:!1,pauseDisabled:!0},error:{text:"Error",class:"status-indicator status-error",startDisabled:!0,pauseDisabled:!0}}[e.toLowerCase()];if(!a){console.warm("Unknown status:",e);return}t.textContent=a.text,o.className=a.class,r.disabled=a.startDisabled,l.disabled=a.pauseDisabled,console.log("Status updated to:",a.text)}function lt(e){const t=document.getElementById("time-step"),o=document.getElementById("total-iterations"),r=document.getElementById("velocity-residual"),l=document.getElementById("pressure-residual"),c=document.getElementById("mass-residual");t&&(t.textContent=j.timeStep),o&&(o.textContent=j.totalIterations),r&&(r.textContent=e.velocity.toExponential(3)),l&&(l.textContent=e.pressure.toExponential(3)),c&&(c.textContent=e.mass.toExponential(3));const a=Fe();a?.onConvergenceUpdate&&a.onConvergenceUpdate({timeStep:j.timeStep,totalIterations:j.totalIterations,velocityResidual:e.velocity.toExponential(3),pressureResidual:e.pressure.toExponential(3),massResidual:e.mass.toExponential(3)});const i=document.getElementById("convergence-canvas");if(i)try{Ie(i)}catch(u){console.error("Error drawing convergence chart:",u)}}function he(){const e=document.getElementById("vel-tolerance"),t=document.getElementById("press-tolerance"),o=document.getElementById("mass-tolerance");if(e){const r=parseFloat(e.value)||1e-6;de("velocity",r)}if(t){const r=parseFloat(t.value)||1e-6;de("pressure",r)}if(o){const r=parseFloat(o.value)||1e-6;de("mass",r)}}function ct(){["vel-tolerance","press-tolerance","mass-tolerance"].forEach(t=>{const o=document.getElementById(t);o&&(o.addEventListener("change",he),o.addEventListener("input",he))})}function ut(e,t,o){console.log("Stating animation loop...");const r=()=>{if(j.state!=="running"){console.log("Animation loop stopped - simulation not running");return}if(!t){console.error("Simulation data not available for animation");return}const c=e.getContext("2d");if(!c){console.error("Failed to get canvas context");return}if(c.clearRect(0,0,e.width,e.height),j.timeStep%1===0){he();let i;try{i=tt(t)}catch(u){console.error("Error updating flow: ",u),j.state="error",te("error");return}if(j.timeStep%5===0)try{const u=nt(t);lt(u)}catch(u){console.error("Error updating convergence display: ",u)}if(!i){const u=Re();u!==null&&(cancelAnimationFrame(u),le(null)),j.state="converged",te("converged"),dt(c,t,o);return}}j.timeStep++;try{pe(c,t,o)}catch(i){console.error("Error rendering frame: ",i)}const a=requestAnimationFrame(r);le(a)},l=requestAnimationFrame(r);le(l)}function ge(){const e=Re();e!==null&&(cancelAnimationFrame(e),le(null),console.log("Animation loop stopped"))}function pe(e,t,o){Ee(e,t,o),Se(e,t)}function dt(e,t,o){console.log("Rendering final convergeed state"),pe(e,t,o)}let Z=null;function ht(e){const t=document.getElementById("start-btn"),o=document.getElementById("pause-btn"),r=document.getElementById("reset-btn");Z={start:()=>{console.log("Start button clicked"),e?.start&&e.start()},pause:()=>{console.log("Pause button clicked"),e?.pause&&e.pause()},reset:()=>{console.log("Reset button clicked"),e?.reset&&e.reset()}},t&&(t.removeEventListener("click",Z.start),t.addEventListener("click",Z.start)),o&&(o.removeEventListener("click",Z.pause),o.addEventListener("click",Z.pause)),r&&(r.removeEventListener("click",Z.reset),r.addEventListener("click",Z.reset)),console.log("Control buttons setup complete")}function ft(){document.querySelectorAll('input[name="vizMode"]').forEach(t=>{t.addEventListener("change",o=>{const r=jt();if(r){r.visualizationMode=o.target.value;const l=document.getElementById("fea-canvas");if(l){const c=l.getContext("2d");c.clearRect(0,0,l.width,l.height),pe(c,r,Fe())}console.log("Visualization mode changed to: ",o.target.value)}})})}function mt(e){console.log("Initializing UI controls...");try{ft(),ct(),ht(e),console.log("UI initialization complete")}catch(t){console.error("Error initializing UI: ",t)}}const j={state:"stopped",timeStep:0,totalIterations:0};let Ae=null;function le(e){Ae=e}function Re(){return Ae}const P={velocity:[],pressure:[],mass:[],maxHistory:200};let ee={velocity:1e-6,pressure:1e-6,mass:1e-6},x=null,L=null;function gt(e,t){if(console.log("=== FEA initialization starting ==="),!e)return console.error("Canvas is null or undefined"),null;const o=e.getContext("2d");return o?(x=t.current,console.log("Canvas Dimensions: ",e.width,"x",e.height),console.log("Simulation Data: ",x),setTimeout(()=>{try{pt(e,o),console.log("=== FEA initialization complete ===")}catch(r){console.error("Failed to initialize FEA: ",r),te("error")}},100),yt(e)):(console.error("Could not get canvas context"),null)}function pt(e,t){t.clearRect(0,0,e.width,e.height),vt(e),console.log("Creating flow domain..."),Oe(x),console.log("Flow domain created. isInside length: ",x.isInside?.length),Te(),we(x),ve(t),te("ready")}function vt(e){x.canvasWidth=e.width,x.canvasHeight=e.height;const t=x.cointrolPoints.exit_x,o=e.width*.9/t;Object.keys(x.controlPoints).forEach(l=>{l.includes("_x")&&(x.controlPoints[l]*=o)});const r=Math.max(x.controlPoints.inlet_radius,x.controlPoints.exit_radius,x.controlPoints.throat_radius);x.scaleY=e.height*.35/r,x.cellWidth=x.canvasWidth/x.cols,x.cellHeight=x.canvasHeight/x.rows}function Te(){const{rows:e,cols:t}=x;x.velocityX=[],x.velocityY=[],x.pressure=[],x.temperature=[],x.density=[];for(let o=0;o<e;o++)x.velocityX[o]=new Array(t).fill(0),x.velocityY[o]=new Array(t).fill(0),x.pressure[o]=new Array(t).fill(101325),x.temperature[o]=new Array(t).fill(300),x.density[o]=new Array(t).fill(1.225)}function ve(e){try{Se(e,x),Ee(e,x,L),console.log("Initial rendering complete")}catch(t){console.error("Error rendering initial state: ",t)}}function yt(e){return{start:()=>xt(e),pause:()=>bt(),reset:()=>Mt(e),setTolerance:(t,o)=>wt(t,o),setCallbacks:t=>Ct(t),updateVisualization:()=>St(e),cleanup:()=>Et()}}function xt(e){console.log("Starting simulation..."),j.state="running",te("running"),L?.onStatusUpdate&&L.onStatusUpdate("running"),ut(e,x,L)}function bt(){console.log("Pausing simulation..."),j.state="paused",te("paused"),L?.onStatusUpdate&&L.onStatusUpdate("paused"),ge()}function Mt(e){console.log("Resetting simulation..."),ge(),j.state="stopped",j.timeStep=0,j.totalIterations=0,P.velocity=[],P.pressure=[],P.mass=[],Te();try{we(x)}catch(o){console.log("Error reinitializing flow: ",o)}te("ready"),L?.onStatusUpdate&&L.onStatusUpdate("ready"),L?.onConvergenceUpdate&&L.onConvergenceUpdate({timeStep:0,totalIterations:0,velocityResidual:"-",pressureResidual:"-",massResidual:"-"});const t=e.getContext("2d");ve(t)}function wt(e,t){console.log(`Setting ${e} tolerance to ${t}`),e in ee&&(ee[e]=t)}function Ct(e){L=e,console.log("Callbacks set: ",Object.keys(L||{}))}function St(e){const t=e.getContext("2d");ve(t)}function Et(){console.log("Cleaning up simulation..."),j.state="stopped",ge()}function jt(){return x}function Fe(){return L}function de(e,t){e in ee&&(ee[e]=t)}function Ft(){const e=S.useRef(null),t=S.useRef(null),o=S.useRef(null),[r,l]=S.useState("Initializing"),[c,a]=S.useState(!1),[i,u]=S.useState("velocity"),[m,p]=S.useState({min:0,avg:0,max:0}),[g,v]=S.useState({timeStep:0,totalIterations:0,velocityResidual:"-",pressureResidual:"-",massResidual:"-"});S.useRef(null);const y=S.useRef(null),[C,f]=S.useState(!1),[h,M]=S.useState({width:800,height:400}),A=E=>{switch(E.toLowerCase()){case"running":return"running";case"paused":return"paused";case"ready":return"ready";case"error":return"error";default:return"unknown"}},I=S.useRef({controlPoints:{inlet_radius:20,inlet_length:50,cp1x:60,cp1y:25,cp2x:100,cp2y:40,cp3x:150,cp3y:60,throat_x:90,throat_radius:15,switcher_x:120,switcher_y:35,exit_x:200,exit_radius:30},scaleY:2,rows:100,cols:200,cellWidth:5,cellHeight:5,canvasHeight:500,visualizationMode:i,velocityX:[],velocityY:[],pressure:[],temperature:[],density:[],isInside:[],isBoundary:[]}),b=S.useCallback(()=>{const E=t.current?.parentElement;if(E){const W=E.clientWidth-120,k=800,R=400;let z=Math.min(W,k),B=z/k*R;z<600&&(z=600,B=300),M({width:z,height:B})}},[]);S.useEffect(()=>(b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)),[b]),S.useEffect(()=>{t.current&&(t.current.width=h.width,t.current.height=h.height,t.current.style.width=`${h.width}px`,t.current.style.height=`${h.height}px`)},[h]),S.useEffect(()=>{C&&I.current&&(I.current.visualizationMode=i)},[i,C]);const w=S.useCallback(()=>{y.current?.start&&(y.current.start(),a(!0),l("Running"))},[]),_=S.useCallback(()=>{y.current?.pause&&(y.current.pause(),a(!1),l("Paused"))},[]),D=S.useCallback(()=>{y.current?.reset&&(y.current.reset(),a(!1),l("Reset"),p({min:0,avg:0,max:0}),v({timeStep:0,totalIterations:0,velocityResidual:"-",pressureResidual:"-",massResidual:"-"}))},[]),U=S.useCallback((E,W)=>{y.current?.setTolerance&&y.current.setTolerance(E,parseFloat(W))},[]);S.useEffect(()=>{let E;const W=()=>{if(console.log("Initializing FEA simulation..."),console.log("Canvas ref:",t.current),console.log("Simulation data:",I.current),!t.current){console.log("Canvas not ready yet, retrying"),E=setTimeout(W,100);return}try{console.log("Canvas is ready, initializing FEA..."),st(t.current,document.getElementById("colorbar"),e.current),I.current.canvasHeight=h.height,y.current=gt(t.current,I),y.current?(y.current.setCallbacks({onStatusUpdate:l,onStatsUpdate:p,onConvergenceUpdate:v}),mt(y.current),f(!0),l("Ready"),console.log("FEA initialization successful")):(console.error("Failed to get simulation control interface"),l("Error"))}catch(R){console.error("Error initializing FEA:",R),l("Error")}};return E=setTimeout(W,200),setTimeout(()=>{if(e.current)try{Ie(e.current)}catch(R){console.error("Failed to draw initial convergence chart",R)}},300),()=>{E&&clearTimeout(E),y.current?.cleanup&&y.current.cleanup()}},[h]);const N=S.useCallback(E=>{u(E.target.value)},[]);return d.jsxs(d.Fragment,{children:[d.jsx($e,{}),d.jsx("div",{className:"title",children:d.jsx("h1",{children:"FEA Nozzle Simulator"})}),d.jsxs("div",{className:"main-layout",children:[d.jsxs("div",{className:"left-section",children:[d.jsxs("div",{className:"canvas-area",children:[d.jsx("canvas",{ref:t,id:"fea-canvas",width:"1000",height:"500",style:{width:`${h.width}px`,height:`${h.height}px`}}),d.jsxs("div",{className:"colorbar-container",children:[d.jsx("div",{id:"colorbar-title",className:"colorbar-labels",children:i.charAt(0).toUpperCase()+i.slice(1)}),d.jsx("div",{id:"max-label",className:"colorbar-labels",children:m.max.toFixed(3)}),d.jsx("canvas",{ref:o,id:"colorbar",width:"30",height:"300"}),d.jsx("div",{id:"mid-label",className:"colorbar-labels",style:{position:"absolute",marginTop:"150px"},children:m.avg.toFixed(3)}),d.jsx("div",{id:"min-label",className:"colorbar-labels",children:m.min.toFixed(3)})]})]}),d.jsxs("div",{className:"controls",children:[d.jsx("strong",{children:"Visualization Mode:"}),d.jsxs("label",{children:[d.jsx("input",{type:"radio",name:"vizMode",value:"pressure",checked:i==="pressure",onChange:N}),"Pressure"]}),d.jsxs("label",{children:[d.jsx("input",{type:"radio",name:"vizMode",value:"velocity",checked:i==="velocity",onChange:N}),"Velocity"]}),d.jsxs("label",{children:[d.jsx("input",{type:"radio",name:"vizMode",value:"temperature",checked:i==="temperature",onChange:N}),"Temperature"]}),d.jsxs("label",{children:[d.jsx("input",{type:"radio",name:"vizMode",value:"density",checked:i==="density",onChange:N}),"Density"]})]}),d.jsxs("div",{className:"stats",children:[d.jsxs("div",{className:"stat-item",children:["Min: ",d.jsx("span",{id:"min-value",className:"stat-value",children:m.min.toFixed(2)})]}),d.jsxs("div",{className:"stat-item",children:["Avg: ",d.jsx("span",{id:"avg-value",className:"stat-value",children:m.avg.toFixed(2)})]}),d.jsxs("div",{className:"stat-item",children:["Max: ",d.jsx("span",{id:"max-value",className:"stat-value",children:m.max.toFixed(2)})]})]})]}),d.jsxs("div",{className:"right-section",children:[d.jsxs("div",{className:"convergence-info",children:[d.jsx("h3",{children:"Simulation Status"}),d.jsxs("div",{className:"convergence-metric",children:[d.jsxs("span",{children:[d.jsx("span",{className:`status-indicator ${A(r)}`,id:"status-indicator"}),"Status:"]}),d.jsx("span",{className:"convergence-value",id:"simulation-status",children:r})]}),d.jsxs("div",{className:"convergence-metric",children:[d.jsx("span",{children:"Time Step:"}),d.jsx("span",{className:"convergence-value",id:"time-step",children:g.timeStep})]}),d.jsxs("div",{className:"convergence-metric",children:[d.jsx("span",{children:"Iterations:"}),d.jsx("span",{className:"convergence-value",id:"total-iterations",children:g.totalIterations})]}),d.jsxs("div",{className:"convergence-metric",children:[d.jsx("span",{children:"Velocity Residual:"}),d.jsx("span",{className:"convergence-value",id:"velocity-residual",children:g.velocityResidual})]}),d.jsxs("div",{className:"convergence-metric",children:[d.jsx("span",{children:"Pressure Residual:"}),d.jsx("span",{className:"convergence-value",id:"pressure-residual",children:g.pressureResidual})]}),d.jsxs("div",{className:"convergence-metric",children:[d.jsx("span",{children:"Mass Residual:"}),d.jsx("span",{className:"convergence-value",id:"mass-residual",children:g.massResidual})]})]}),d.jsxs("div",{className:"convergence-controls",children:[d.jsx("h3",{children:"Controls"}),d.jsxs("div",{style:{textAlign:"center",marginBottom:"15px"},children:[d.jsx("button",{className:"control-button",id:"start-btn",onClick:w,disabled:c,children:"Start"}),d.jsx("button",{className:"control-button",id:"pause-btn",onClick:_,disabled:!c,children:"Pause"}),d.jsx("button",{className:"control-button",id:"reset-btn",onClick:D,children:"Reset"})]}),d.jsx("hr",{}),d.jsxs("div",{style:{margin:"10px 0"},children:[d.jsx("label",{htmlFor:"vel-tolerance",children:"Velocity Tolerance:"}),d.jsx("input",{type:"number",className:"tolerance-input",id:"vel-tolerance",defaultValue:"1e-6",step:"1e-7",placeholder:"1e-6",onChange:E=>U("velocity",E.target.value)})]}),d.jsxs("div",{style:{margin:"10px 0"},children:[d.jsx("label",{htmlFor:"press-tolerance",children:"Pressure Tolerance:"}),d.jsx("input",{type:"number",className:"tolerance-input",id:"press-tolerance",defaultValue:"1e-6",step:"1e-7",placeholder:"1e-6",onChange:E=>U("pressure",E.target.value)})]}),d.jsxs("div",{style:{margin:"10px 0"},children:[d.jsx("label",{htmlFor:"mass-tolerance",children:"Mass Tolerance:"}),d.jsx("input",{type:"number",className:"tolerance-input",id:"mass-tolerance",defaultValue:"1e-6",step:"1e-7",placeholder:"1e-6",onChange:E=>U("mass",E.target.value)})]})]}),d.jsxs("div",{className:"convergence-canvas",children:[d.jsx("h3",{children:"Convergence History"}),d.jsx("canvas",{ref:e,id:"convergence-canvas",width:"400",height:"250"})]})]})]})]})}export{Ft as default};
//# sourceMappingURL=FEA-BLyQwIe8.js.map
