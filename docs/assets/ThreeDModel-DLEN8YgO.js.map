{"version":3,"file":"ThreeDModel-DLEN8YgO.js","sources":["../../src/pages/ThreeDModel.jsx"],"sourcesContent":["import {useEffect, useRef, useState } from \"react\";\r\nimport * as THREE from 'three';\r\nimport '../styles.css'\r\n\r\nconst ThreeDModel = () => {\r\n  const gameAreaRef = useRef(null);\r\n  const sceneRef = useRef(null);\r\n  const animationIdRef = useRef(null);\r\n  const rendererRef = useRef(null);\r\n  const [isActive, setIsActive] = useState(false);\r\n\r\n  const stateRef = useRef({\r\n    isActive: false,\r\n    rotationX: 0,\r\n    rotationY: 0,\r\n    moveForward: false,\r\n    moveBackward: false,\r\n    moveLeft: false,\r\n    moveRight: false,\r\n    moveUp: false,\r\n    moveDown: false,\r\n    isRotating: false,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (!gameAreaRef.current) return;\r\n\r\n    const gameArea = gameAreaRef.current;\r\n\r\n    while (gameArea.firstChild) {\r\n      gameArea.removeChild(gameArea.firstChild);\r\n    }\r\n\r\n    const scene = new THREE.Scene();\r\n    const camera = new THREE.PerspectiveCamera(75, gameArea.clientWidth / gameArea.clientHeight, 0.1, 1000);\r\n    const renderer = new THREE.WebGLRenderer({ antialias: true});\r\n    \r\n    renderer.setSize(gameArea.clientWidth, gameArea.clientHeight);\r\n    gameArea.appendChild(renderer.domElement);\r\n    rendererRef.current = renderer;\r\n\r\n    // create cube, add to scene\r\n    const geometry = new THREE.TorusKnotGeometry();\r\n\r\n    const vertexShader = `\r\n      varying vec3 vNormal;\r\n      void main() {\r\n        vNormal = normalize(normalMatrix * normal);\r\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n      }`;\r\n\r\n    const fragmentShader = `\r\n      varying vec3 vNormal;\r\n      void main() {\r\n        vec3 lightDirection = normalize(vec3(-1.0,1.0,0.0)); //light location is to left and above camera\r\n        float intensity = pow(max(dot(vNormal, lightDirection), 0.0), 2.5); // make edges glow\r\n        gl_FragColor = vec4(0.0, intensity, 0.0, 1.0); // greenish glow on edges\r\n      }`;\r\n\r\n    const material = new THREE.ShaderMaterial({ \r\n      vertexShader, \r\n      fragmentShader, \r\n      wireframe: false, \r\n    });\r\n\r\n    const cube = new THREE.Mesh(geometry, material);\r\n    scene.add(cube);\r\n\r\n    camera.position.z = 5;\r\n\r\n    const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);\r\n    scene.add(ambientLight);\r\n    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.7);\r\n    directionalLight.position.set(-1, -1, -1).normalize();\r\n    scene.add(directionalLight);\r\n    \r\n    //store references\r\n    sceneRef.current = { scene, camera, renderer, cube };\r\n\r\n    const movementSpeed = 0.1;\r\n    const rotationSpeed = 0.01; \r\n\r\n    const activateIndicator = document.createElement('div');\r\n    const exitIndicator = document.createElement('div');\r\n\r\n    activateIndicator.innerText = \"Click Here to Activate Viewport\";\r\n    activateIndicator.className = 'activate-indicator';\r\n    exitIndicator.innerText = \"Press Esc to Exit Viewport\";\r\n    exitIndicator.className = 'exit-indicator';   \r\n\r\n    gameArea.appendChild(activateIndicator);\r\n    gameArea.appendChild(exitIndicator);\r\n\r\n    const updateIndicators = (active) => {\r\n      activateIndicator.style.display = active ? 'none' : 'block';\r\n      exitIndicator.style.display = active ? 'block' : 'none';\r\n    };\r\n\r\n    const handleActivateClick = (event) => {\r\n      // console.log(\"Activate button clicked\");\r\n      // console.log(\"rendererRef.current:\", rendererRef.current);\r\n      // console.log(\"renderer.domElement:\", rendererRef.current?.domElement);\r\n      setIsActive(true);\r\n      stateRef.current.isActive = true;\r\n      updateIndicators(true);\r\n\r\n      if (rendererRef.current && rendererRef.current.domElement) {\r\n        rendererRef.current.domElement.style.cursor = 'grab';\r\n        rendererRef.current.domElement.style.pointerEvents = 'auto';\r\n        rendererRef.current.domElement.style.position = 'relative';\r\n        rendererRef.current.domElement.style.zIndex = '1';\r\n        // console.log(\"Canvas cursor set to grab\");\r\n        // console.log(\"Canvas element:\", rendererRef.current.domElement);\r\n        // console.log(\"Canvas position:\", rendererRef.current.domElement.getBoundingClientRect());\r\n      }\r\n\r\n      event.stopPropagation();\r\n    };\r\n\r\n    const handleKeyDown = (event) => {\r\n      if (event.key === 'Escape' && stateRef.current.isActive) {\r\n        setIsActive(false);\r\n        stateRef.current.isActive = false;\r\n        updateIndicators(false);\r\n        return;\r\n      }\r\n\r\n      if (stateRef.current.isActive) {\r\n        switch (event.key.toLowerCase()) {\r\n          case 'w': stateRef.current.moveForward = true; break;\r\n          case 's': stateRef.current.moveBackward = true; break;\r\n          case 'a': stateRef.current.moveLeft = true; break;\r\n          case 'd': stateRef.current.moveRight = true; break;\r\n          case ' ': \r\n            event.preventDefault();  \r\n            stateRef.current.moveUp = true; \r\n            break;\r\n          case 'control': stateRef.current.moveDown = true; break;\r\n          case 'arrowup': sceneRef.current.cube.position.y += 1; break;\r\n          case 'arrowdown': sceneRef.current.cube.position.y -= 1; break;\r\n          case 'arrowleft': sceneRef.current.cube.position.x -= 1; break;\r\n          case 'arrowright': sceneRef.current.cube.position.x += 1; break;\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleKeyUp = (event) => {\r\n      switch (event.key.toLowerCase()) {\r\n        case 'w': stateRef.current.moveForward = false; break;\r\n        case 's': stateRef.current.moveBackward = false; break;\r\n        case 'a': stateRef.current.moveLeft = false; break;\r\n        case 'd': stateRef.current.moveRight = false; break;\r\n        case ' ': stateRef.current.moveUp = false; break;\r\n        case 'control': stateRef.current.moveDown = false; break;\r\n      }\r\n    };\r\n\r\n    const handleMouseDown = (event) => {\r\n      if (stateRef.current.isActive && event.button === 0) {\r\n        // console.log(\"Mouse down - starting rotation\");\r\n        stateRef.current.isRotating = true;\r\n        if(rendererRef.current) {\r\n          rendererRef.current.domElement.style.cursor = 'grabbing';\r\n        }\r\n        event.preventDefault();\r\n      }\r\n    };\r\n\r\n    const handleMouseUp = (event) => {\r\n      if (event.button === 0) {\r\n        // console.log(\"Mouse up - stopping rotation\");\r\n        stateRef.current.isRotating = false;\r\n        if(stateRef.current.isActive && rendererRef.current) {\r\n          rendererRef.current.domElement.style.cursor = 'grab';\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleMouseMove = (event) => {\r\n      if (!stateRef.current.isActive || !stateRef.current.isRotating) return;\r\n      if (sceneRef.current) {\r\n        const deltaX = event.movementX || 0;\r\n        const deltaY = event.movementY || 0;\r\n        // console.log(\"Mouse move - deltaX:\", deltaX, \"deltaY:\", deltaY);\r\n        // console.log(\"Cube before:\", sceneRef.current.cube.rotation.x, sceneRef.current.cube.rotation.y);\r\n        sceneRef.current.cube.rotation.x += deltaY * rotationSpeed; \r\n        sceneRef.current.cube.rotation.y += deltaX * rotationSpeed;\r\n        // console.log(\"Cube after:\", sceneRef.current.cube.rotation.x, sceneRef.current.cube.rotation.y);\r\n      }\r\n    };\r\n\r\n    const handleResize = () => {\r\n      const width = gameArea.clientWidth;\r\n      const height = gameArea.clientHeight;\r\n      renderer.setSize(width, height);\r\n      camera.aspect = width / height;\r\n      camera.updateProjectionMatrix();\r\n    };\r\n\r\n    activateIndicator.addEventListener('click', handleActivateClick);\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    document.addEventListener('keyup', handleKeyUp);\r\n    renderer.domElement.addEventListener('mousedown', handleMouseDown);\r\n    renderer.domElement.addEventListener('mouseup', handleMouseUp);\r\n    renderer.domElement.addEventListener('mousemove', handleMouseMove);\r\n    window.addEventListener('resize', handleResize);\r\n\r\n    // console.log(\"Event listeners added\");\r\n    // console.log(\"Canvas element:\", renderer.domElement);\r\n    // console.log(\"Canvas parent:\", renderer.domElement.parentElement);\r\n    // console.log(\"Canvas z-index:\", window.getComputedStyle(renderer.domElement).zIndex);\r\n    // console.log(\"Canvas pointer-events:\", window.getComputedStyle(renderer.domElement).pointerEvents);\r\n\r\n    const animate = () => {\r\n      animationIdRef.current = requestAnimationFrame(animate);\r\n\r\n      if (stateRef.current.isActive && sceneRef.current) {\r\n        const cube = sceneRef.current.cube;\r\n        if (stateRef.current.moveForward) cube.position.z += movementSpeed;\r\n        if (stateRef.current.moveBackward) cube.position.z -= movementSpeed;\r\n        if (stateRef.current.moveLeft) cube.position.x += movementSpeed;\r\n        if (stateRef.current.moveRight) cube.position.x -= movementSpeed;\r\n        if (stateRef.current.moveUp) cube.position.y -= movementSpeed;\r\n        if (stateRef.current.moveDown) cube.position.y += movementSpeed;\r\n      }\r\n\r\n      renderer.render(scene, camera);\r\n    }\r\n\r\n    animate();\r\n\r\n    //clean up function\r\n    return () => {\r\n      if (animationIdRef.current) {\r\n        cancelAnimationFrame(animationIdRef.current);\r\n      }\r\n\r\n      activateIndicator.removeEventListener('click', handleActivateClick);\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n      document.removeEventListener('keyup', handleKeyUp);\r\n      renderer.domElement.removeEventListener('mousedown', handleMouseDown);\r\n      renderer.domElement.removeEventListener('mouseup', handleMouseUp);\r\n      renderer.domElement.removeEventListener('mousemove', handleMouseMove);\r\n      window.removeEventListener('resize', handleResize);\r\n\r\n      if (gameArea && gameArea.contains(activateIndicator)) {\r\n        gameArea.removeChild(activateIndicator);\r\n      }\r\n\r\n      if (gameArea && gameArea.contains(exitIndicator)) {\r\n        gameArea.removeChild(exitIndicator);\r\n      }\r\n\r\n      if (rendererRef.current) {\r\n        rendererRef.current.dispose();\r\n      }\r\n\r\n      geometry.dispose();\r\n      material.dispose();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"three-d-model-container\">\r\n      <div className=\"container\">\r\n        <h1>3D Interactive Model</h1>\r\n        <p style={{textAlign: 'center'}}>\r\n          Click viewport to activate. Click esc to deactivate viewport. W,S move in into screen/away from screen. \r\n          A/D move sideways. Space/Ctrl move up/down. Hold down and drag left mouse button to rotate.\r\n        </p>\r\n      </div>\r\n      <div ref={gameAreaRef} style={{width: '100%', height: '100vh', position: 'relative', overflow: 'hidden'}}></div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ThreeDModel;"],"names":["ThreeDModel","gameAreaRef","useRef","sceneRef","animationIdRef","rendererRef","isActive","setIsActive","useState","stateRef","useEffect","gameArea","scene","THREE.Scene","camera","THREE.PerspectiveCamera","renderer","THREE.WebGLRenderer","geometry","THREE.TorusKnotGeometry","vertexShader","fragmentShader","material","THREE.ShaderMaterial","cube","THREE.Mesh","ambientLight","THREE.AmbientLight","directionalLight","THREE.DirectionalLight","movementSpeed","rotationSpeed","activateIndicator","exitIndicator","updateIndicators","active","handleActivateClick","event","handleKeyDown","handleKeyUp","handleMouseDown","handleMouseUp","handleMouseMove","deltaX","deltaY","handleResize","width","height","animate","jsxs","jsx"],"mappings":"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"}